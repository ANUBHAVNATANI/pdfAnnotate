<!-- index.htm -->
<html>
  <head>
    <script src="./_bundles/pdfAnnotate.js" async></script>
  </head>
  <body>
    <div id="app"></div>
     <button id="addTextAnnotation" type="button">Add Text Annotation</button>
     <button id="download" type="button">Download</button>
     <button id="showAnnotations" type="button">Show Annotations</button>
    <script>

            let once = false
            let pdfFactory = undefined

            let fileLoad = function (filepath) {
                    if (once)
                            return

                    once = true
                    console.log("Load " + filepath)

                    pdfAnnotate.AnnotationFactory.loadFile(filepath).then((factory) => {
                            pdfFactory = factory
                            console.log(factory)
                    })
            }

            document.querySelector('#download').addEventListener('click', (evt) => {
                    pdfFactory.download()
            })

            document.querySelector('#addTextAnnotation').addEventListener('click', (evt) => {
                    pdfFactory.createTextAnnotation(0, [50, 50, 80, 80], "Test123", "John")
            })

            document.querySelector('#showAnnotations').addEventListener('click', (evt) => {
                    pdfFactory.getAnnotations().then( (data) => {
                            document.querySelector('#app').innerHTML = data.map(d => d.type)
                    })
            })

            window.onload =  function(){
                    fileLoad("./test3.pdf")
            }
    </script>
  </body>
</html>
